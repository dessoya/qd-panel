'use strict'

var Class			= require('class')

var Pool = Class.inherit({

	onCreate: function(moc_data) {
		this.moc_data = moc_data
	},

	query: function(query, params, callback) {
		
		if('function' === typeof params) {
			callback = params
		}

		else {
			// console.log('query params')
			do {
				var index = query.indexOf('?')
				if(index !== -1) {
					var param = params.shift()

					switch(typeof param) {
					case 'string':
						param = '"' + param + '"'
						break
					}

					query = query.substr(0, index) + param + query.substr(index + 1)
				}
			} while (index !== -1)
		}

		process.nextTick(function() {
			if(query in this.moc_data) {
				callback(null, this.moc_data[query])
			}
			else {
				// console.log('wrong query: '+query)
				callback(new Error('query not found: >'+query+'<'))
			}
		}.bind(this))
	}

})

module.exports = Pool
